
## 第一讲 基本运算部件

### 高级语言程序中的运算
- 基本数据类型：无符号数、带符号整数、浮点数、位串、字符（串）
- 基本运算类型：算术、按位、逻辑、移位、扩展和截断、匹配

### 运算实现方式
- 将表达式编译为指令序列
- 计算机直接执行指令完成运算
- 需要提供逻辑运算、移位、扩展和截断等指令

### 定点数运算
- 算术运算：
  - 带符号整数：取负/符号扩展/加/减/乘/除/算术移位
  - 无符号整数：0扩展/加/减/乘/除
- 逻辑运算：与/或/非
- 移位操作：逻辑左移/逻辑右移

### 基本运算部件
1. 加法器
   - 串行进位加法器
   - 并行进位加法器
   - 全先行进位加法器
   - 两级/多级先行进位加法器
2. 带标志加法器
3. 算术逻辑部件（ALU）

## 串行进位加法器
- 缺点：进位按串行方式传递，速度慢
- 延迟时间：
  - n位串行加法器从C0到Cn：2n+1级门延迟
  - 最后一位和数：2n级门延迟
  - Sum延迟：6ty；Carryout延迟：2ty

### 4位串行进位加法器实现
```verilog
module FA (
  input x, y, cin,
  output f, cout
);
  assign f = x ^ y ^ cin;
  assign cout = (x & y) | (x & cin) | (y & cin);
endmodule

module CRA (
  input [3:0] x, y,
  input cin,
  output [3:0] f,
  output cout
);
  wire [4:0] c;
  assign c[0] = cin;
  FA fa0(x[0], y[0], c[0], f[0], c[1]);
  FA fa1(x[1], y[1], c[1], f[1], c[2]);
  FA fa2(x[2], y[2], c[2], f[2], c[3]);
  FA fa3(x[3], y[3], c[3], f[3], c[4]);
  assign cout = c[4];
endmodule
```

## 并行进位加法器（CLA）
- 先行进位方式：加快进位传递
- 进位生成/传递函数：
  - Gi = AiBi（进位生成函数）
  - Pi = Ai+Bi（进位传递函数）
- 全加逻辑方程：
  - Si = Ai⊕Bi⊕Ci
  - Ci+1 = Gi + PiCi

### 4位先行进位部件（CLU）
- 各进位之间无等待，相互独立并同时产生
- 进位计算公式：
  - C1 = G0 + P0C0
  - C2 = G1 + P1G0 + P1P0C0
  - C3 = G2 + P2G1 + P2P1G0 + P2P1P0C0
  - C4 = G3 + P3G2 + P3P2G1 + P3P2P1G0 + P3P2P1P0C0

### 4位CLA实现
```verilog
module CLA (
  input [3:0] x, y,
  input cin,
  output [3:0] f,
  output cout
);
  wire [4:0] c;
  wire [4:1] p, g;
  assign c[0] = cin;
  FA_PG fa0(x[0], y[0], c[0], f[0], p[1], g[1]);
  FA_PG fa1(x[1], y[1], c[1], f[1], p[2], g[2]);
  FA_PG fa2(x[2], y[2], c[2], f[2], p[3], g[3]);
  FA_PG fa3(x[3], y[3], c[3], f[3], p[4], g[4]);
  CLU clu(p, g, c[0], c[4:1]);
  assign cout = c[4];
endmodule

module FA_PG (
  input x, y, cin,
  output f, p, g
);
  assign f = x ^ y ^ cin;
  assign p = x | y;
  assign g = x & y;
endmodule

module CLU (
  input [4:1] p, g,
  input c0,
  output [4:1] c
);
  assign c[1] = g[1] | (p[1] & c0);
  assign c[2] = g[2] | (p[2] & g[1]) | (p[2] & p[1] & c0);
  assign c[3] = g[3] | (p[3] & g[2]) | (&{p[3:2], g[1]}) | (&{p[3:1], c0});
  assign c[4] = g[4] | (p[4] & g[3]) | (&{p[4:3], g[2]}) | (&{p[4:2], g1}) | (&{p[4:1], c0});
endmodule
```

## 局部（单级）先行进位加法器
- 关键路径延迟：1+2+2+2+2+3=12ty
- 特点：组内并行、组间串行

## 多级先行进位加法器
- 实现"组内并行、组间并行"进位方式
- 组进位生成/传递函数：
  - G3* = G3 + P3G2 + P3P2G1 + P3P2P1G0
  - P3* = P3P2P1P0
  - C4 = G3* + P3*C0

### 16位两级先行进位加法器
- 关键路径长度：3+2+3=8ty
- 最终进位延迟：3+2=5ty

## n位带标志加法器
- 标志位：
  - 溢出标志OF = Cn⊕Cn-1
  - 符号标志SF = Fn-1
  - 零标志ZF = 1当且仅当F=0
  - 进位/借位标志CF = Cout⊕Cin

### 4位带标志先行进位加法器实现
```verilog
module CLA_FLAGS (
  input [3:0] a, b,
  input cin,
  output [3:0] f,
  output OF, SF, ZF, CF,
  output cout
);
  // CLA模块相同代码
  assign OF = c[4] ^ c[3];
  assign SF = f[3];
  assign ZF = ~(|f);
  assign CF = c[4] ^ c[0];
endmodule
```

## 算术逻辑部件（ALU）
- 功能：
  - 无符号整数加、减
  - 带符号整数加、减
  - 与、或、非、异或等逻辑运算
- 核心电路：整数加/减运算部件
- 操作控制端ALUop：决定ALU执行的处理功能

### 1-bit ALU和4-bit ALU
```verilog
module ALU (
  input [3:0] a, b,
  input [1:0] aluop,
  input cin,
  output [3:0] f,
  output OF, SF, ZF, CF,
  output cout
);
  wire [3:0] sum;
  CLA_FLAGS(a, b, cin, sum, OF, SF, ZF, CF, cout);
  always @(*) begin
    case(aluop)
      2'b00: f = a & b;
      2'b01: f = a | b;
      2'b10: f = sum;
      default: f = 0;
    endcase
  end
endmodule
```

## 第二讲 定点数运算

### 定点数加减运算
1. 补码加减运算
   - [A+B]补 = [A]补 + [B]补 (mod 2^n)
   - [A-B]补 = [A]补 + [-B]补 (mod 2^n)
2. 原码加减运算
   - 符号位和数值部分分开处理
   - 同号求和，异号求差
3. 移码加减运算
   - 移码的和、差等于和、差的补码

### 定点数乘法运算
1. 原码乘法运算
   - 符号和数值分开运算
   - 数值部分用无符号数乘法实现
2. 补码乘法运算