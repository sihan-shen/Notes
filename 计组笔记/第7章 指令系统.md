
### 第1讲 概述与指令系统设计

#### 指令系统概述
- 冯·诺依曼结构机器对指令规定：
  - 用二进制表示，和数据一起存放在主存中
  - 由两部分组成：操作码和操作数（或其地址码）
- 指令系统处在软/硬件交界面
  - 硬件设计者角度：易于硬件设计
  - 系统程序员角度：易于编写编译器
- 指令系统设计影响：计算机的性能和成本

#### 一条指令包含的信息
1. 操作码：指定操作类型
2. 源操作数参照
3. 结果值参照
4. 下一条指令地址

#### 指令中地址码字段数量
- 零地址指令
- 一地址指令
- 二地址指令（最常用）
- 三地址指令（RISC风格）
- 多地址指令

#### 指令执行周期涉及的问题
1. 取指令：指令地址、指令长度
2. 译码：指令格式、操作码编码、操作数类型
3. 取操作数：地址码、寻址方式
4. 执行：操作类型、标志或条件码
5. 存储结果：目的操作数
6. 下条指令地址：顺序/转移

#### 指令格式设计原则
- 尽量短
- 足够的操作码位数
- 编码唯一解释
- 字长是字节的整数倍
- 合理选择地址字段个数
- 指令尽量规整

#### 操作数类型和存储方式
- 地址（指针）
- 数值数据
  - 定点数
  - 浮点数
  - 十进制数
- 位、位串、字符和字符串
- 逻辑（布尔）数据

#### 寻址方式
- 定义：指令或操作数地址的指定方式
- 地址码编码原则：
  - 尽量短
  - 操作数存放位置灵活
  - 地址计算简单
- 基本寻址方式：
  - 立即/直接/间接
  - 寄存器/寄存器间接
  - 偏移/栈

#### 基本寻址方式的算法和优缺点
| 方式 | 算法 | 优点 | 缺点 |
|------|------|------|------|
| 立即数 | 操作数=A | 执行速度快 | 操作数幅值有限 |
| 直接 | EA=A | 计算简单 | 地址范围有限 |
| 间接 | EA=(A) | 地址范围大 | 多次存储器访问 |
| 寄存器 | 操作数=(R) | 执行快，指令短 | 地址范围有限 |
| 寄存器间接 | EA=(R) | 地址范围大 | 额外存储器访问 |
| 偏移 | EA=A+(R) | 灵活 | 复杂 |
| 栈 | EA=栈顶 | 指令短 | 应用有限 |

#### 偏移寻址方式
- 相对寻址：EA=A+(PC)
- 基址寻址：EA=A+(B)
- 变址寻址：EA=A+(I)

#### 操作码编码方式
1. 定长操作码编码
   - 译码方便，但有信息冗余
2. 扩展（变长）操作码编码
   - 操作码长度分成几种固定格式

#### 条件测试方式
- 常用标志：
  - SF（negative）
  - OF（overflow）
  - CF（进位/借位）
  - ZF（zero）
- 标志存储位置：
  - 标志寄存器
  - 通用寄存器

#### 指令设计风格
1. 按操作数位置指定风格：
   - 累加器型
   - 栈型
   - 通用寄存器型
   - 装入/存储型
2. 按指令格式复杂度：
   - CISC（复杂指令集计算机）
   - RISC（精简指令集计算机）

#### 异常和中断处理机制
- 异常分类：
  - 故障（fault）
  - 自陷（trap）
  - 终止（abort）
- 中断分类：
  - 可屏蔽中断
  - 不可屏蔽中断
- 响应过程：
  1. 关中断
  2. 保护断点和程序状态
  3. 识别中断事件

### 第2讲 指令系统实例：RISC-V架构

#### RISC-V指令系统概述
- 设计目标：
  - 广泛的适应性
  - 支持异构处理架构
  - 稳定且可扩展
- 特点：
  - 模块化结构
  - 稳定性和可扩展性好

#### RISC-V的模块化结构
- 核心：RV32I
- 标准扩展集：
  - RV32M
  - RV32F
  - RV32D
  - RV32A

#### RISC-V指令格式
1. 32位指令格式：
   - R型
   - I型
   - S型
   - B型
   - U型
   - J型
2. 16位压缩指令格式

#### RISC-V基础整数指令集（RV32I）
1. 整数运算类指令
   - U型指令：lui, auipc
   - I型指令：addi, slli等
   - R型指令：add, sub等
2. 控制转移类指令
   - J型：jal
   - I型：jalr
   - B型：beq, bne等
3. 存储访问指令
   - I型：lb, lh等
   - S型：sb, sh等
4. 系统控制类指令
   - fence
   - ecall, ebreak
   - csrxxx

#### RISC-V扩展指令集
- RV64I
- RV32M/RV64M
- RV32F/RV64F
- RV32D/RV64D
- RV32A/RV64A
- 向量处理指令集RVV

#### RISC-V中整数的乘、除运算处理
- 乘法指令：
  - mul
  - mulh
  - mulhu
  - mulhsu
- 除法指令：
  - div
  - divu
  - rem
  - remu

### 本章总结
1. 指令格式：
   - 定长指令字
   - 变长指令字
2. 操作类型：
   - 数据传送
   - 操作运算
   - 程序流控制
   - 系统控制
3. 寻址方式：
   - 立即
   - 直接
   - 间接
   - 寄存器
   - 寄存器间接
   - 栈
   - 偏移寻址
4. 指令系统风格：
   - 按地址码指定风格
   - 按指令系统复杂度